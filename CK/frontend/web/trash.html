<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>RÃ¡c | CloudVault</title>
  <link rel="stylesheet" href="css/style.css">
  
  <style>
    .trash-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
    }
    .trash-item h3 {
        margin: 0;
        flex: 1;
    }
    .trash-item .btn-restore {
        background-color: #28a745; /* MÃ u xanh lÃ¡ */
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
    }
    .trash-item .btn-delete-perm {
        background-color: #dc3545; /* MÃ u Ä‘á» */
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
    }
  </style>

</head>
<body>
    <header class="header">
    <div class="logo">
        <img src="assets/Logo.png" alt="CloudVault Logo">
    </div>
    <div class="title">CloudVault</div>
    <div class="user-actions">
        <button id="loginBtn" onclick="window.location.href='login.html'">ÄÄƒng nháº­p</button>
        <button id="registerBtn" onclick="window.location.href='register.html'">ÄÄƒng kÃ½</button>
        <span id="userName" class="hidden"></span>
        <button id="logoutBtn" class="hidden">ÄÄƒng xuáº¥t</button>
    </div>
</header>

    <nav class="nav-bar">
    <ul>
        <li><a href="index.html">ğŸ“Š Dashboard</a></li>
        <li><a href="documents.html">ğŸ“‚ TÃ i liá»‡u</a></li> 
        <li><a href="recent.html">â±ï¸ Gáº§n Ä‘Ã¢y</a></li>
        <li><a href="favorites.html">â¤ï¸ YÃªu thÃ­ch</a></li>
        <li><a href="trash.html" class="active">ğŸ—‘ï¸ RÃ¡c</a></li>
        <li><a href="settings.html">âš™ï¸ Cáº¥u hÃ¬nh</a></li>
    </ul>
    <a href="upload.html" class="btn-new">ğŸ“¤ Táº£i lÃªn</a>
</nav>

    <main class="content">
    <h2 style="color: #667eea; font-size: 24px; font-weight: 700; margin-bottom: 10px;">ğŸ—‘ï¸ RÃ¡c</h2>
    <p style="color: #666; margin-bottom: 25px;">TÃ i liá»‡u sáº½ bá»‹ xÃ³a vÄ©nh viá»…n sau 30 ngÃ y</p>

        <div class="doc-grid" id="trash-container">
        <p>Äang táº£i thÃ¹ng rÃ¡c...</p>
    </div>
  </main>

    <footer class="footer">
    <p>Kho lÆ°u giá»¯ cá»§a tÃ´i Â© 2026</p>
  </footer>

    <script src="js/api.js"></script>
  <script src="js/main.js"></script>

    <script>
    const trashContainer = document.getElementById("trash-container"); 
    async function loadTrash() {
        if (!isLoggedIn()) {
            trashContainer.innerHTML = '<p><a href="login.html">ÄÄƒng nháº­p</a> Ä‘á»ƒ xem thÃ¹ng rÃ¡c.</p>';
            return;
        }

        try { 
            const data = await getTrashDocuments();
            
            if (data.documents && data.documents.length > 0) {
                trashContainer.innerHTML = "";  
                 
                data.documents.forEach(doc => {
                    const docCard = `
                        <div class="doc-card trash-item">
                            <h3>${doc.filename}</h3>
                            <div class="doc-card-actions">
                                <button class="btn-restore" data-id="${doc.id}">KhÃ´i phá»¥c</button>
                                <button class="btn-delete-perm" data-id="${doc.id}">XÃ³a vÄ©nh viá»…n</button>
                            </div>
                        </div>
                    `;
                    trashContainer.innerHTML += docCard;
                });
            } else {
                trashContainer.innerHTML = "<p>ThÃ¹ng rÃ¡c cá»§a báº¡n trá»‘ng.</p>";
            }
        } catch (error) {
            console.error("Lá»—i táº£i thÃ¹ng rÃ¡c:", error);
            trashContainer.innerHTML = "<p>KhÃ´ng thá»ƒ táº£i thÃ¹ng rÃ¡c.</p>";
        }
    }
 
    trashContainer.addEventListener('click', async (e) => {
        const restoreBtn = e.target.closest('.btn-restore');
        const deleteBtn = e.target.closest('.btn-delete-perm');
 
        if (restoreBtn) {
            const docId = restoreBtn.dataset.id;
            if (confirm("Báº¡n cÃ³ muá»‘n khÃ´i phá»¥c tÃ i liá»‡u nÃ y?")) {
                try {
                    await restoreDocument(docId);  
                    alert("KhÃ´i phá»¥c thÃ nh cÃ´ng!");
                    loadTrash();  
                } catch (err) {
                    alert("Lá»—i: " + err.message);
                }
            }
        }
        
        if (deleteBtn) {
            const docId = deleteBtn.dataset.id;
            if (confirm("Cáº¢NH BÃO: Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n XÃ“A VÄ¨NH VIá»„N file nÃ y? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.")) {
                try {
                    await permanentDeleteDocument(docId);  
                    alert("ÄÃ£ xÃ³a vÄ©nh viá»…n!");
                    loadTrash();  
                } catch (err) {
                    alert("Lá»—i: " + err.message);
                }
            }
        }
    });

    loadTrash();
  </script>

</body>
</html>