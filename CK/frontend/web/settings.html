<!DOCTYPE html>
<html lang="vi">
<head>
Â  <meta charset="UTF-8">
  <title>CÃ i Ä‘áº·t | LÆ°u Giá»¯ TÃ i Liá»‡u</title>
Â  <link rel="stylesheet" href="css/style.css">
  
  <style>
    .settings-form {
    max-width: 800px;       /* Giá»›i háº¡n chiá»u rá»™ng Ä‘á»ƒ khÃ´ng bá»‹ quÃ¡ to */
    margin: 0 auto 25px auto; /* CÄƒn giá»¯a khung cÃ i Ä‘áº·t */
    background-color: #fff;
    padding: 30px;
    border-radius: 12px;    /* Bo trÃ²n Ä‘á»“ng bá»™ vá»›i thanh menu */
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .settings-form h3 {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }
    .settings-form label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        font-size: 0.9em;
    }
    .settings-form input[type="text"],
    .settings-form input[type="email"],
    .settings-form input[type="password"] {
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;     /* Bo trÃ²n nháº¹ cho Ã´ nháº­p liá»‡u */
        font-size: 1rem;
        box-sizing: border-box; /* Äáº£m báº£o padding khÃ´ng lÃ m trÃ n khung */
    }
    .settings-form input[type="email"][disabled] {
        background-color: #f4f4f4;
        color: #777;
        cursor: not-allowed;
    }
    .settings-form .btn-save {
        background-color: #007bff;
        color: white;
        padding: 12px 18px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
    }
    .settings-form .btn-save:hover {
        background-color: #007bff;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        width: auto;
    }
    .settings-form .msg {
        margin-top: 15px;
        font-size: 0.95em;
        display: none; /* áº¨n ban Ä‘áº§u */
    }
    .msg.success { display: block; color: green; }
    .msg.error { display: block; color: red; }
  </style>
</head>
<body>
Â  <header class="header">
Â  Â  <div class="logo">
        <img src="assets/Logo.png" alt="Logo">
    </div>
    <div class="title">
        <span>LÆ°u Giá»¯ TÃ i Liá»‡u</span>
    </div>
    <div class="user-actions">
        <button id="loginBtn" onclick="window.location.href='login.html'">ÄÄƒng nháº­p</button>
        <button id="registerBtn" onclick="window.location.href='register.html'">ÄÄƒng kÃ½</button>
        
        <span id="userName" class="hidden"></span>
</header>
    <nav class="nav-bar">
    <a href="upload.html" class="btn-new">+ UPLOAD</a>
    <ul>
        <li><a href="index.html">ğŸ  Trang chá»§</a></li>
        <li><a href="documents.html">ğŸ“ Kho lÆ°u trá»¯ cá»§a tÃ´i</a></li> 
        <li><a href="recent.html">ğŸ•“ Ná»™i dung gáº§n Ä‘Ã¢y</a></li>
        <li><a href="trash.html">ğŸ—‘ï¸ ThÃ¹ng rÃ¡c</a></li>
        <li><a href="favorites.html">â­ Bá»™ nhá»›</a></li>
        <li><a href="settings.html" class="active">âš™ï¸ CÃ i Ä‘áº·t</a></li>
    </ul>
</nav>

Â  Â  <main class="content">
Â  Â  <h2>âš™ï¸ CÃ i Ä‘áº·t tÃ i khoáº£n</h2>
Â  Â  
    <div class="settings-form">
      <h3>ThÃ´ng tin cÃ¡ nhÃ¢n</h3>
      <form id="infoForm">
        <label for="infoName">Há» vÃ  tÃªn:</label>
        <input type="text" id="infoName" name="name" required placeholder="Äang táº£i...">
        
        <label for="infoEmail">Email (KhÃ´ng thá»ƒ thay Ä‘á»•i):</label>
        <input type="email" id="infoEmail" name="email" disabled placeholder="Äang táº£i...">
        
        <button type="submit" class="btn-save">LÆ°u thay Ä‘á»•i</button>
        <p class="msg" id="infoMsg"></p>
      </form>
    </div>
    
    <div class="settings-form">
      <h3>Äá»•i máº­t kháº©u</h3>
      <form id="passwordForm">
        <label for="passOld">Máº­t kháº©u cÅ©:</label>
        <input type="password" id="passOld" required>
        
        <label for="passNew">Máº­t kháº©u má»›i (Ã­t nháº¥t 6 kÃ½ tá»±):</label>
        <input type="password" id="passNew" minlength="6" required>
        
        <label for="passConfirm">XÃ¡c nháº­n máº­t kháº©u má»›i:</label>
        <input type="password" id="passConfirm" minlength="6" required>
        
        <button type="submit" class="btn-save">Äá»•i máº­t kháº©u</button>
        <p class="msg" id="passMsg"></p>
      </form>
    </div>
Â  </main>

Â  Â  <footer class="footer">
Â  Â  <p>Kho lÆ°u trá»¯ cá»§a tÃ´i Â© 2026</p>
Â  </footer>

Â  Â  <script src="js/api.js"></script>
Â  <script src="js/main.js"></script>
Â  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
        // 1. Kiá»ƒm tra Ä‘Äƒng nháº­p
        if (!isLoggedIn()) {
            window.location.href = "login.html";
            return;
        }

        const infoForm = document.getElementById("infoForm");
        const passForm = document.getElementById("passwordForm");
        const infoMsg = document.getElementById("infoMsg");
        const passMsg = document.getElementById("passMsg");

        // 2. Táº£i thÃ´ng tin user hiá»‡n táº¡i
        const infoNameEl = document.getElementById("infoName");
        const infoEmailEl = document.getElementById("infoEmail");
        
        // (HÃ m getMe() tá»« api.js)
        getMe().then(data => {
            infoNameEl.value = data.name;
            infoEmailEl.value = data.email;
        }).catch(err => {
            infoMsg.textContent = "KhÃ´ng thá»ƒ táº£i thÃ´ng tin user: " + err.message;
            infoMsg.className = "msg error";
        });

        // 3. Xá»­ lÃ½ Form thÃ´ng tin (Cáº­p nháº­t tÃªn)
        infoForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const newName = infoNameEl.value.trim();
            infoMsg.textContent = "Äang cáº­p nháº­t...";
            infoMsg.className = "msg";

            try {
                // (HÃ m updateMe() tá»« api.js)
                const data = await updateMe(newName);
                infoMsg.textContent = data.message || "Cáº­p nháº­t thÃ nh cÃ´ng!";
                infoMsg.className = "msg success";
            } catch (err) {
                infoMsg.textContent = err.message;
                infoMsg.className = "msg error";
            }
        });

        // 4. Xá»­ lÃ½ Form máº­t kháº©u
        passForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const oldPass = document.getElementById("passOld").value;
            const newPass = document.getElementById("passNew").value;
            const confirmPass = document.getElementById("passConfirm").value;
            
            passMsg.textContent = "Äang xá»­ lÃ½...";
            passMsg.className = "msg";

            if (newPass !== confirmPass) {
                passMsg.textContent = "Máº­t kháº©u má»›i khÃ´ng khá»›p!";
                passMsg.className = "msg error";
                return;
            }

            try {
                // (HÃ m changePassword() tá»« api.js)
                const data = await changePassword(oldPass, newPass);
                passMsg.textContent = data.message || "Äá»•i máº­t kháº©u thÃ nh cÃ´ng!";
                passMsg.className = "msg success";
                passForm.reset(); // XÃ³a cÃ¡c trÆ°á»ng
            } catch (err) {
                passMsg.textContent = err.message; // apiRequest sáº½ tá»± bÃ¡o lá»—i (vd: Máº­t kháº©u cÅ© khÃ´ng Ä‘Ãºng)
                passMsg.className = "msg error";
            }
        });
    });
  </script>
</body>
</html>